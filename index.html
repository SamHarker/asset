<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Gestione Postazioni</title>
  <style>
    body { font-family: Arial; background:#2b2b2b; color:white; text-align:center; }
    table { border-collapse: collapse; width:90%; margin:20px auto; }
    th, td { border:1px solid red; padding:8px; text-align:center; }
    thead tr { background:black; }
    tbody tr:nth-child(odd){ background:#4d4d4d; }
    tbody tr:nth-child(even){ background:#808080; }
    .duplicate { background-color:#ff4444; color:white; font-weight:bold; }
    #dupCount { margin:15px; font-size:18px; font-weight:bold; color:yellow; }
    .remove-btn { background:#cc0000; color:white; border:none; padding:4px 8px; border-radius:4px; cursor:pointer; }
    .remove-btn:hover { background:#990000; }
  </style>
</head>
<body>

  <h1>üìã Gestione Postazioni di Lavoro</h1>
  <div id="dupCount">‚ö†Ô∏è Duplicati trovati: 0</div>
  
  <button class="btn" onclick="exportJSON()">üíæ Salva in JSON</button>
  <input type="file" id="fileInput" class="btn" accept=".json">
  <button class="btn" onclick="addRow()">‚ûï Aggiungi riga</button>
  
  <table id="postazioni">
    <thead>
      <tr>
        <th>Stanza</th>
        <th>Scrivania</th>
        <th>Workstation</th>
        <th>Monitor</th>
        <th>Docking</th>
        <th>Note</th>
        <th>Azioni</th>
      </tr>
    </thead>
    <tbody>
      <!-- Popolato automaticamente -->
    </tbody>
  </table>

  <script>
    function highlightDuplicates() {
      const table = document.getElementById("postazioni");
      const colsToCheck = [2, 3, 4];
      let duplicateCount = 0;

      Array.from(table.tBodies[0].rows).forEach(row => {
        colsToCheck.forEach(i => row.cells[i].classList.remove("duplicate"));
      });

      colsToCheck.forEach(colIndex => {
        const values = {};
        Array.from(table.tBodies[0].rows).forEach(row => {
          const cell = row.cells[colIndex];
          const val = cell.textContent.trim();
          if (val) {
            if (values[val]) {
              cell.classList.add("duplicate");
              values[val].classList.add("duplicate");
              duplicateCount++;
            } else {
              values[val] = cell;
            }
          }
        });
      });

      document.getElementById("dupCount").textContent = `‚ö†Ô∏è Duplicati trovati: ${duplicateCount}`;
    }

    function populateTable(data) {
      const tbody = document.querySelector("#postazioni tbody");
      tbody.innerHTML = "";
      data.forEach(item => {
        const row = tbody.insertRow();
        row.innerHTML = `
          <td contenteditable="true">${item.stanza}</td>
          <td contenteditable="true">${item.scrivania}</td>
          <td contenteditable="true">${item.workstation}</td>
          <td contenteditable="true">${item.monitor}</td>
          <td contenteditable="true">${item.docking}</td>
          <td contenteditable="true">${item.note}</td>
          <td><button class="remove-btn" onclick="removeRow(this)">‚ùå Rimuovi</button></td>
        `;
      });
      highlightDuplicates();
    }

    async function loadJSON() {
      try {
        const response = await fetch("postazioni.json");
        if (!response.ok) throw new Error("File non trovato");
        const data = await response.json();
        populateTable(data);
      } catch (error) {
        alert("‚ö†Ô∏è Errore nel caricamento del JSON: " + error.message);
      }
    }

    function removeRow(button) {
      button.closest("tr").remove();
      highlightDuplicates();
    }

    window.onload = loadJSON;
  </script>

</body>
</html>

